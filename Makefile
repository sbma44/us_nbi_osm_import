osm:
	rm -rf us_osm
	mkdir us_osm
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/alabama-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/alaska-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/arizona-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/arkansas-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/california-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/colorado-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/connecticut-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/delaware-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/district-of-columbia-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/florida-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/georgia-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/hawaii-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/idaho-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/illinois-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/indiana-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/iowa-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/kansas-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/kentucky-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/louisiana-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/maine-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/maryland-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/massachusetts-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/michigan-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/minnesota-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/mississippi-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/missouri-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/montana-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/nebraska-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/nevada-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/new-hampshire-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/new-jersey-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/new-mexico-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/new-york-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/north-carolina-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/north-dakota-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/ohio-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/oklahoma-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/oregon-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/pennsylvania-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/rhode-island-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/south-carolina-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/south-dakota-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/tennessee-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/texas-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/utah-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/vermont-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/virginia-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/washington-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/west-virginia-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/wisconsin-latest.osm.pbf" -O
	cd us_osm && curl "http://download.geofabrik.de/north-america/us/wyoming-latest.osm.pbf" -O
	touch us_osm.done

nbi:
	rm -rf nbi
	mkdir nbi	
	curl "https://s3.amazonaws.com/gis-data/nbi/2013allstatesallrecsdel.zip" > nbi/nbi.zip
	cd nbi && unzip nbi.zip	&& rm nbi.zip
	cat nbi/allstatesallrecs13del.txt | iconv -f utf-8 -t utf-8 -c > nbi/nbi.csv
	rm nbi/allstatesallrecs13del.txt
	bash -c "source .nhtsa_nbi_osm_import/bin/activate && python segment.py nbi/nbi.csv && rm nbi/nbi.csv"

build:
	bash -c "source .nhtsa_nbi_osm_import/bin/activate && python build_osm_nbi_import.py"

install:
	sudo apt-get install -y postgis osm2pgsql python3 python-pip postgresql-server-dev-all python3-dev 
	sudo pip install virtualenvwrapper
	bash -c "virtualenv -p `which python3` .nhtsa_nbi_osm_import && source .nhtsa_nbi_osm_import/bin/activate && pip install -r requirements.txt"
	bash -c "sudo -u postgres createuser --superuser `whoami`"
	mkdir build

clean:
	rm -rf nbi
	rm -rf us_osm


